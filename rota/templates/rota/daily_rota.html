{% extends "rota/base.html" %}

{% block title %}Daily Rota – {{ date }}{% endblock %}

{% block content %}
<div class="page-header">
  <h1>Daily Rota – {{ date }}</h1>
  <div class="nav-links">
    <a href="{% url 'monthly_calendar' date.year date.month %}">&larr; Back to month</a>
  </div>
</div>

{% if not assignments %}
  <div class="info-banner warning">
    No Assigned Rota for Today.
  </div>
{% else %}
  <div class="info-banner info">
    Showing {{ assignments|length }} assignment{{ assignments|length|pluralize }} for this day.
  </div>
{% endif %}


<div class="suite-row">
  {% for block in rooms_grid %}
    <div class="cleanroom-block">
      <h2>{{ block.room.name }}</h2>

      <div class="room-supervisors-box">
        <div class="room-supervisors-title">Room Supervisors</div>

        {% if block.room.room_supervisors %}
          <ul class="room-supervisors-list">
            {% for sup in block.room.room_supervisors %}
              <li>{{ sup.full_name }}</li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="room-supervisors-empty">No room supervisors assigned yet.</p>
        {% endif %}
      </div>


      <div class="walls">

        {# ========== LEFT WALL (title swapped) ========== #}
        <div class="wall">
          <div class="wall-title">Left Wall</div>

          {% if block.right_wall %}
            {% for iso in block.right_wall %}
              <div class="isolator-box">
                <div class="isolator-name">{{ iso.name }}</div>

                {% if iso.has_assignments %}
                  <div class="isolator-assignees">
                    {% for a in iso.batch_assignments %}
                      <div>Batch {{ a.batch_number }} – {{ a.staff.full_name }}</div>
                    {% endfor %}
                  </div>
                {% else %}
                  <div class="isolator-empty">No duties assigned yet.</div>
                {% endif %}

                <div class="isolator-actions">
                  <button class="btn-pill isolator-btn show-btn"
                          data-open-modal="modal-duties-{{ iso.id }}">
                    Show Duties
                  </button>

                  {% if user.is_superuser or perms.rota.rota_manager %}
                    <button class="btn-pill isolator-btn edit-btn"
                            data-open-modal="modal-isolator-{{ iso.id }}">
                      Edit Assignments
                    </button>
                  {% endif %}
                </div>

                {% include "rota/partials/isolator_modal.html" with iso=iso room=block.room date=date staff_list=staff_list supervisors=supervisors %}
                {% include "rota/partials/isolator_duties_modal.html" with iso=iso date=date %}
              </div>
            {% endfor %}
          {% else %}
            <div class="isolator-empty">No isolators on this wall.</div>
          {% endif %}
        </div>


        {# ========== RIGHT WALL (title swapped) ========== #}
        <div class="wall">
          <div class="wall-title">Right Wall</div>

          {% if block.left_wall %}
            {% for iso in block.left_wall %}
              <div class="isolator-box">
                <div class="isolator-name">{{ iso.name }}</div>

                {% if iso.has_assignments %}
                  <div class="isolator-assignees">
                    {% for a in iso.batch_assignments %}
                      <div>Batch {{ a.batch_number }} – {{ a.staff.full_name }}</div>
                    {% endfor %}
                  </div>
                {% else %}
                  <div class="isolator-empty">No duties assigned yet.</div>
                {% endif %}

                <div class="isolator-actions">
                  <button class="btn-pill isolator-btn show-btn"
                          data-open-modal="modal-duties-{{ iso.id }}">
                    Show Duties
                  </button>

                  {% if user.is_superuser or perms.rota.rota_manager %}
                    <button class="btn-pill isolator-btn edit-btn"
                            data-open-modal="modal-isolator-{{ iso.id }}">
                      Edit Assignments
                    </button>
                  {% endif %}
                </div>

                {% include "rota/partials/isolator_modal.html" with iso=iso room=block.room date=date staff_list=staff_list supervisors=supervisors %}
                {% include "rota/partials/isolator_duties_modal.html" with iso=iso date=date %}
              </div>
            {% endfor %}
          {% else %}
            <div class="isolator-empty">No isolators on this wall.</div>
          {% endif %}
        </div>

      </div>
    </div>
  {% endfor %}
</div>

{% endblock content %}
