{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    {# Tailwind can stay for later; harmless if empty #}
    <link rel="stylesheet" href="{% static 'rota/css/tailwind.css' %}">
    {# Your main custom CSS #}
    <link rel="stylesheet" href="{% static 'rota/css/main.css' %}" />

    <title>{% block title %}Skedaddle Rota{% endblock %}</title>

    {% block extra_head %}{% endblock %}
  </head>

  <body>
    <header class="navbar">
      <div class="navbar-left">
        <a href="{% url 'home' %}" class="navbar-brand">Skedaddle Rota</a>
      </div>

    <nav class="navbar-links">
      <a href="{% url 'monthly_calendar' year=today.year month=today.month %}">
        Calendar
      </a>

      <a href="{% url 'daily_rota' year=today.year month=today.month day=today.day %}">
        Today
      </a>

      {% if perms.rota.rota_viewer %}
        <a href="{% url 'staff_search' %}">Staff Search</a>
      {% endif %}

      {% if perms.rota.rota_manager %}
        <a href="{% url 'validation:matrix' %}">APS</a>
      {% endif %}

      {% if user.is_authenticated and user.is_superuser %}
        <a href="{% url 'staff_list' %}">Staff</a>
        <a href="/admin/">Admin</a>
      {% endif %}
    </nav>


      <div class="navbar-right">
        {% if user.is_authenticated %}
          <span>{{ user.username }}</span>
          <a class="btn-pill" href="{% url 'logout' %}">Logout</a>
        {% else %}
          <a class="btn-pill" href="{% url 'login' %}">Login</a>
        {% endif %}
      </div>
    </header>

    {# Optional simple messages bar #}
    {% if messages %}
      {% for message in messages %}
        <div class="message {{ message.tags }}">{{ message }}</div>
      {% endfor %}
    {% endif %}

    <main class="page-wrapper">
      <div class="flash-messages">
        {% if messages %}
          {% for message in messages %}
            <div
              class="flash-message {% if message.tags == 'success' %}flash-success{% elif message.tags == 'error' %}flash-error{% endif %}"
            >
              {{ message }}
            </div>
          {% endfor %}
        {% endif %}
      </div>

      {% block content %}{% endblock %}
    </main>

    <script>
      (function () {
        function openModal(id) {
          const modal = document.getElementById(id);
          if (!modal) return;
          modal.classList.remove("hidden");
          modal.setAttribute("aria-hidden", "false");
          document.documentElement.classList.add("overflow-hidden");
        }

        function closeModal(modal) {
          modal.classList.add("hidden");
          modal.setAttribute("aria-hidden", "true");
          document.documentElement.classList.remove("overflow-hidden");
        }

        // Open: any element with data-open-modal="modal-id"
        document.addEventListener("click", (e) => {
          const opener = e.target.closest("[data-open-modal]");
          if (opener) {
            e.preventDefault();
            openModal(opener.getAttribute("data-open-modal"));
            return;
          }

          // Close: click anything with data-close-modal inside a modal
          const closer = e.target.closest("[data-close-modal]");
          if (closer) {
            const modal = e.target.closest(".fixed.inset-0.z-50");
            if (modal) closeModal(modal);
          }
        });

        // Close on Escape
        document.addEventListener("keydown", (e) => {
          if (e.key !== "Escape") return;
          const openModalEl = document.querySelector(".fixed.inset-0.z-50:not(.hidden)");
          if (openModalEl) closeModal(openModalEl);
        });
      })();
    </script>

  </body>
</html>
